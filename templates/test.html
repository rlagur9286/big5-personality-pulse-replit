{% extends "base.html" %}

{% block title %}{% if lang == 'en' %}Big5 Personality Test - Question {{ current }}/{{ total }}{% else %}Big5 ì„±ê²© í…ŒìŠ¤íŠ¸ - ì§ˆë¬¸ {{ current }}/{{ total }}{% endif %}{% endblock %}

{% block content %}
<div class="test-container">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <!-- Progress Bar -->
                <div class="progress-container mb-4">
                    <div class="progress-info">
                        <span class="progress-text">{% if lang == 'en' %}Answered{% else %}ë‹µë³€ ì™„ë£Œ{% endif %}</span>
                        <span class="progress-numbers">{{ answered_count }}/{{ total }}</span>
                    </div>
                    <div class="progress">
                        <div class="progress-bar" style="width: {{ progress }}%"></div>
                    </div>
                    <div class="progress-percentage">{{ "%.0f"|format(progress) }}%</div>
                </div>
                


                <!-- Question Card -->
                <div class="question-card">
                    <div class="question-header">
                        <div class="question-number">Q{{ current }}</div>
                        <div class="question-factor">
                            {% if question.factor == 'O' %}
                                ğŸ¨ {% if lang == 'en' %}Openness{% else %}ê°œë°©ì„±{% endif %}
                            {% elif question.factor == 'C' %}
                                ğŸ“‹ {% if lang == 'en' %}Conscientiousness{% else %}ì„±ì‹¤ì„±{% endif %}
                            {% elif question.factor == 'E' %}
                                ğŸ‰ {% if lang == 'en' %}Extraversion{% else %}ì™¸í–¥ì„±{% endif %}
                            {% elif question.factor == 'A' %}
                                ğŸ¤ {% if lang == 'en' %}Agreeableness{% else %}ìš°í˜¸ì„±{% endif %}
                            {% elif question.factor == 'N' %}
                                ğŸ˜° {% if lang == 'en' %}Neuroticism{% else %}ì‹ ê²½ì„±{% endif %}
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="question-text">
                        {{ question.text }}
                    </div>

                    <form method="POST" class="answer-form">
                        <div class="answer-options">
                            <label class="answer-option">
                                <input type="radio" name="answer" value="1" {% if existing_answer == 1 %}checked{% endif %}>
                                <div class="option-content">
                                    <div class="option-emoji">ğŸ˜«</div>
                                    <div class="option-text">{% if lang == 'en' %}Strongly Disagree{% else %}ì „í˜€ ê·¸ë ‡ì§€ ì•Šë‹¤{% endif %}</div>
                                </div>
                            </label>
                            
                            <label class="answer-option">
                                <input type="radio" name="answer" value="2" {% if existing_answer == 2 %}checked{% endif %}>
                                <div class="option-content">
                                    <div class="option-emoji">ğŸ˜</div>
                                    <div class="option-text">{% if lang == 'en' %}Disagree{% else %}ê·¸ë ‡ì§€ ì•Šë‹¤{% endif %}</div>
                                </div>
                            </label>
                            
                            <label class="answer-option">
                                <input type="radio" name="answer" value="3" {% if existing_answer == 3 %}checked{% endif %}>
                                <div class="option-content">
                                    <div class="option-emoji">ğŸ˜Š</div>
                                    <div class="option-text">{% if lang == 'en' %}Neutral{% else %}ë³´í†µì´ë‹¤{% endif %}</div>
                                </div>
                            </label>
                            
                            <label class="answer-option">
                                <input type="radio" name="answer" value="4" {% if existing_answer == 4 %}checked{% endif %}>
                                <div class="option-content">
                                    <div class="option-emoji">ğŸ˜„</div>
                                    <div class="option-text">{% if lang == 'en' %}Agree{% else %}ê·¸ë ‡ë‹¤{% endif %}</div>
                                </div>
                            </label>
                            
                            <label class="answer-option">
                                <input type="radio" name="answer" value="5" {% if existing_answer == 5 %}checked{% endif %}>
                                <div class="option-content">
                                    <div class="option-emoji">ğŸ¤©</div>
                                    <div class="option-text">{% if lang == 'en' %}Strongly Agree{% else %}ë§¤ìš° ê·¸ë ‡ë‹¤{% endif %}</div>
                                </div>
                            </label>
                        </div>

                        <div class="form-actions">
                            <div class="navigation-buttons">
                                {% if current > 1 %}
                                <button type="submit" name="action" value="prev" class="btn btn-outline-secondary btn-lg">
                                    <i class="fas fa-arrow-left me-2"></i>{% if lang == 'en' %}Previous{% else %}ì´ì „{% endif %}
                                </button>
                                {% endif %}
                                
                                <button type="submit" name="action" value="next" class="btn btn-primary btn-lg btn-next" {% if not existing_answer %}disabled{% endif %} id="nextBtn">
                                    {% if current == total %}
                                        <i class="fas fa-check me-2"></i>{% if lang == 'en' %}See Results{% else %}ê²°ê³¼ ë³´ê¸°{% endif %}
                                    {% else %}
                                        <i class="fas fa-arrow-right me-2"></i>{% if lang == 'en' %}Next{% else %}ë‹¤ìŒ{% endif %}
                                    {% endif %}
                                </button>
                            </div>
                            
                            {% if answered_count >= total %}
                            <div class="finish-option mt-3">
                                <button type="submit" name="action" value="finish" class="btn btn-success btn-lg">
                                    <i class="fas fa-flag-checkered me-2"></i>{% if lang == 'en' %}Finish Test{% else %}í…ŒìŠ¤íŠ¸ ì™„ë£Œ{% endif %}
                                </button>
                            </div>
                            {% endif %}
                        </div>
                    </form>
                </div>

                <!-- Motivation Messages -->
                <div class="motivation-message">
                    {% if lang == 'en' %}
                        {% set messages = [
                            "Great! You're more than halfway done! ğŸ‰",
                            "Almost there! Just a little more! ğŸ’ª",
                            "I'm getting curious about your personality! âœ¨",
                            "Honest answers make accurate results! ğŸ¯",
                            "Final sprint! You're almost finished! ğŸƒâ€â™€ï¸"
                        ] %}
                    {% else %}
                        {% set messages = [
                            "ì¢‹ì•„ìš”! ì ˆë°˜ ì´ìƒ ì™„ë£Œí–ˆì–´ìš” ğŸ‰",
                            "ê±°ì˜ ë‹¤ ì™”ì–´ìš”! ì¡°ê¸ˆë§Œ ë” í˜ë‚´ì„¸ìš” ğŸ’ª",
                            "ë‹¹ì‹ ì˜ ì„±ê²©ì´ ê¶ê¸ˆí•´ì§€ë„¤ìš” âœ¨",
                            "ì •ì§í•œ ë‹µë³€ì´ ì •í™•í•œ ê²°ê³¼ë¥¼ ë§Œë“¤ì–´ìš” ğŸ¯",
                            "ë§ˆì§€ë§‰ ìŠ¤í¼íŠ¸! ê±°ì˜ ì™„ì£¼í–ˆì–´ìš” ğŸƒâ€â™€ï¸"
                        ] %}
                    {% endif %}
                    {% if current > 25 %}
                        {{ messages[(current // 10) % messages|length] }}
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const radioButtons = document.querySelectorAll('input[name="answer"]');
    const nextButton = document.getElementById('nextBtn');
    const answerOptions = document.querySelectorAll('.answer-option');

    // Initialize selected state based on existing answer
    function initializeSelectedState() {
        const checkedRadio = document.querySelector('input[name="answer"]:checked');
        if (checkedRadio) {
            const selectedOption = checkedRadio.closest('.answer-option');
            selectedOption.classList.add('selected');
            nextButton.disabled = false;
            nextButton.classList.add('btn-pulse');
        }
    }

    // Enable next button when an answer is selected
    radioButtons.forEach(radio => {
        radio.addEventListener('change', function() {
            nextButton.disabled = false;
            nextButton.classList.add('btn-pulse');
        });
    });

    // Add click animation to answer options
    answerOptions.forEach(option => {
        option.addEventListener('click', function() {
            // Remove active class from all options
            answerOptions.forEach(opt => opt.classList.remove('selected'));
            // Add active class to clicked option
            this.classList.add('selected');
        });
    });

    // Add keyboard navigation
    document.addEventListener('keydown', function(e) {
        if (e.key >= '1' && e.key <= '5') {
            const radioButton = document.querySelector(`input[value="${e.key}"]`);
            if (radioButton) {
                radioButton.checked = true;
                radioButton.dispatchEvent(new Event('change'));
                radioButton.closest('.answer-option').click();
            }
        }
        
        if (e.key === 'Enter' && !nextButton.disabled) {
            nextButton.click();
        }
        
        // Navigation shortcuts
        if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') {
            const prevButton = document.querySelector('button[value="prev"]');
            if (prevButton) {
                e.preventDefault();
                prevButton.click();
            }
        }
        
        if (e.key === 'ArrowRight' || e.key === 'ArrowDown') {
            if (!nextButton.disabled) {
                e.preventDefault();
                nextButton.click();
            }
        }
    });

    // Initialize on page load
    initializeSelectedState();
});
</script>
{% endblock %}
